% Hardness of the monadic logic with equivalenceIn this section we show that the (finite) satisfiability of monadic first-orderlogic with a single equivalence symbol $\Lvp\Fo\nonv1\Eea1\noag$ is$\ceNExpTime2$-hard by reducing the doubly exponential tiling problem to suchsatisfiability. Our strategy is to employ a counter setup of $\szu$ unarypredicate symbols to encode the exponentially many positions of a binaryencoding of a doubly exponentially bounded quantity, encoding the coordinaes ofa cell of the doubly exponential tiling square.Consider the counter setup $\CS(\szu) = \seq{\suu1,\suu2,\dots,\suu\szu}$ for$\szu \in \pNats$. Recall that the intention of a counter setup is to encode anarbitrary exponentially bounded value at every element of a structure.Let $\DS(\szu, \sco) = \CS(\szu) + \seq{\sco, \sd}$ be a predicate signatureenriching $\CS(\szu)$ with the \emph{control predicate symbol} $\sco$ and thebuiltin equivalence symbol $\sd$.We will define a system where every $\sd$-equivalence class includesexponentially many cells satisfying the control predicate symbol. These cellswill correspond to the exponentially many positions of the binary encoding of adoubly exponential value for the $\sd$-class. The bit values at each cellposition will be encoded by the cardinality of that cell: bit value $0$ if thecardinality of the cell is $1$ and bit value $1$ if the cardinality is greaterthan $1$.Call the data $\data\CS\StrA\ea$, encoded by the counter setup at $\ea$ the\emph{position} of $\ea$.\begin{definition}Let $\StrA$ be a $\DS = \DS(\szu,\sco)$-structure. Define the quantifier-free$\vFoF2\DS$-formula $\feqpos\DS(\xx,\yy)$ by:\[  \feqpos\DS(\xx,\yy) = \sco(\xx) \land \sco(\yy) \land \feq\CS(\xx,\yy).\]\end{definition}Then $\StrA \vDash \feqpos\DS(\ea,\eb)$ iff $\ea$ and $\eb$ satisfy the controlpredicate and are at the same positions:$\data\CS\StrA\ea = \data\CS\StrA\eb$.\begin{definition}Define the quantifier-rank-$1$ $\vFoF2\DS$-formula $\fbitO\DS(\xx)$ by:\[  \fbitO\DS(\xx) = \sco(\xx) \land \forall\yy   \sco(\yy) \land \sd(\yy,\xx) \land \feq\CS(\yy,\xx)  \limp \yy = \xx.\]\end{definition}Then $\StrA \vDash \fbitO\DS(\ea)$ iff the cell of $\ea$ has cardinality $1$.\begin{definition}Define the quantifier-rank-$1$ $\vFoF2\DS$-formula $\fbitI\DS(\xx)$ by:\[  \fbitI\DS(\xx) = \exists\yy \sco(\yy) \land \sd(\xx,\yy) \land  \feq\CS(\yy,\xx) \land \yy \neq \xx.\]\end{definition}Then $\StrA \vDash \fbitI\DS(\ea)$ iff the cell of $\ea$ has cardinality greaterthan $1$.\begin{definition}Define the quantifier-free $\vFoF2\DS$-formula $\fposzero\DS(\xx)$ by:\[  \fposzero\DS(\xx) = \sco(\xx) \land  \bigwedge_{1 \leq \ii \leq \szu} \lnot\suu\ii(\xx).\]\end{definition}Then $\StrA \vDash \fposzero\DS(\ea)$ iff the position of $\ea$ is $0$.\begin{definition}Define the quantifier-free $\vFoF2\DS$-formula $\fposmax\DS(\xx)$ by:\[  \fposmax\DS(\xx) = \sco(\xx) \land  \bigwedge_{1 \leq \ii \leq \szu} \suu\ii(\xx).\]\end{definition}Then $\StrA \vDash \fposmax\DS(\ea)$ iff the position of $\ea$ is$\largtbit\szu$.\begin{definition}Define the quantifier-free $\vFoF2\DS$-formula $\fpossucc\DS(\xx,\yy)$ by:\[  \fpossucc\DS(\xx,\yy) = \sco(\xx) \land \sco(\yy) \land \sd(\xx,\yy) \land  \fsucc\CS(\xx,\yy).\]\end{definition}Then $\StrA \vDash \fpossucc\DS(\ea,\eb)$ iff $\ea$ and $\eb$ are in the same$\relD$-class and the position of $\eb$ is the successor of the position of$\ea$.\begin{definition}Define the quantifier-free $\vFoF2\DS$-formula $\fposless\DS(\xx,\yy)$ by:\[  \fposless\DS(\xx,\yy) = \sco(\xx) \land \sco(\yy) \land \sd(\xx,\yy) \land  \fless\CS(\xx,\yy).\]\end{definition}Then $\StrA \vDash \fposless\DS(\ea,\eb)$ iff $\ea$ and $\eb$ are in the same$\relD$-class and the position of $\ea$ is less than the position of $\eb$.\begin{definition}For $\posp \in \tBitnums\szu$, define the $\vFoF2\DS$-formula$\fposp\DS\posp(\xx)$ recursively by:\[  \fposp\DS0(\xx) = \fposzero\DS(\xx)\]and for $\posp < \largtbit\szu$:\[  \fposp\DS{(\posp+1)}(\xx) = \exists\yy \fposp\DS\posp(\yy) \land  \fpossucc\DS(\xx,\yy).\]In this case, for the formula to be a two-variable formula,the formula $\fposp\DS\posp(\yy)$ is obtained from $\fposp\DS\posp(\xx)$ byswapping all occurences (not only the unbounded ones) of the variables $\xx$ and$\yy$.Note that the length of the formula $\fposp\DS\posp(\xx)$ is linear in $\posp$.\end{definition}Then $\StrA \vDash \fposp\DS\posp(\ea)$ iff $\posp$ is the position of $\ea$.\begin{definition}Define the closed $\vFoF2\DS$-formula $\ffullpos\DS$ by:\begin{align*}  \ffullpos\DS =  \left(\forall\yy\exists\xx \sco(\xx) \land \sd(\xx,\yy) \land    \fposzero\DS(\xx)\right) \land \\  \left(  \forall\xx \sco(\xx) \land \lnot\fposmax\DS(\xx) \limp  \exists\yy \fpossucc\DS(\xx,\yy)\right).\end{align*}\end{definition}The first part of this formula asserts that every $\sd$-class has an element atposition $0$. The second part asserts that if $\ea$ is an element at position$\posp$, that is not the largest possible, there exists an element $\eb$ in thesame $\sd$-class at position $\posp + 1$.Therefore in any model of $\ffullpos\DS$, every $\sd$-class has $2^\szu$ cellssatisfying $\sco$. For example, in particular, every $\sd$-class has cardinalityat least $2^\szu$.\begin{definition}Let $\StrA$ be a $\DS$-structure. Let $\relD = \at\StrA\sd$.Define the function$\gls{Data-D-A} : \Ecl\relD \to \tBitstrings{2^\szu}$ by:\[  \Data\DS\StrA_\posp \setS = \begin{cases}  1 &\text{if } \data\CS\StrA(\ea) = \posp-1 \text{ implies }   \StrA \vDash \fbitI\DS(\ea)  \text{ for all } \ea \in \setS  \\  0 &\text{otherwise.}  \end{cases}\]\end{definition}\begin{definition}Define the quantifier-rank-$1$ $\vFoF2\DS$-formula $\gls{fZero-D-x}$ by:\[  \fZero\DS(\xx) = \forall\yy \sco(\yy) \land \sd(\yy,\xx) \limp  \fbitO\DS(\yy).\] \end{definition}Then $\StrA \vDash \fZero\DS(\ea)$ iff $\Data\DS\StrA(\ea) = \benc{0}$.\begin{definition}Let $\nN \in \tBitnums{2^\szu}$ be a $\tbit$-bit number, where$\tbit = \bsz\nN \leq 2^\szu$.Define the $\vFoF2\DS$-formula $\fDataN\DS\nN(\xx)$ by:\begin{align*}  \fDataN\DS\nN(\xx) = \forall\yy \sco(\yy) \land \sd(\yy,\xx) \limp  \forall\xx \sco(\xx) \land \sd(\xx,\yy) \limp \\  \left(\bigwedge_{0 \leq \posp < \tbit} \fposp\DS\posp(\yy) \limp  \fbit\DS{(\benc\nN_{\posp+1})}(\yy)\right) \land \\  \left(\fposp\DS{(\tbit-1)}(\yy) \land \fposless\DS(\yy,\xx) \limp  \fbitO\DS(\xx) \right).\end{align*}\end{definition}The first part of this formula asserts that the bits at the first $\tbit$positions of the $\sd$-class of $\xx$ encode the number $\nN$.The second part asserts that all the remaining bits at larger positions arezeroes.Note that the length of this formula is polynomially bounded by $\tbit$, thebitsize of $\nN$.We have $\StrA \vDash \fDataN\DS\nN(\ea)$ iff $\data\DS\StrA(\ea) = \benc{\nN}$.