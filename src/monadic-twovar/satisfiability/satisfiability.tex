% Monadic two-variable satisfiability

Let $\uUS\szu = \seq{\suu1,\suu2,\dots,\suu\szu}$ be an unary predicate
signature having length $\szu$.
Let $\eES\nex = \seq{\see1,\see2,\dots,\see\nex}$ be a binary predicate
consisting of $\nex$ builtin equivalence symbols in refinement.
Let $\uesigS\szu\nex = \uUS\szu + \eES\nex$, so $\uesigS\szu\nex$ is a generic
predicate signature for the logics $\Lvp\Fo20\Eea\nex\agrefine$ and
$\Lvp\Fo21\Eea\nex\agrefine$.

\begin{remark}\label{rem:twovar-granular}
Let $\szu, \nex \in \Nats$ such that $\nex \geq 2$ and consider
$\sigS = \uesigS\szu\nex$.
Abbreviate $\sd = \see1$ and $\se = \see2$.
Let $\StrA$ be a $\sigS$-structure.
There is $\StrB \subseteq \StrA$ such that
$\StrA \vequiv2 \StrB$ and $\seq{\at\StrB\sd,\at\StrB\se}$ is $\gr$-granular
for $\gr = 3.(3^{2^\szu}-1)$.
\end{remark}
\begin{proof}
By \cref{lem:twovar-cell-2}, there is $\StrBp \subseteq \StrA$ such that
$\StrA \vequiv2 \StrBp$ and the cells of $\StrBp$ have cardinality at most $2$.
By \cref{lem:twovar-organ-2}, there is $\StrB \subseteq \StrBp$ such that
$\StrB \vequiv2 \StrBp$ and the organs of $\StrB$ have cardinality at most $2$.
Let $\relD = \at\StrB\sd$ and $\relE = \at\StrB\se$.
Let $\eclX$ be any $\relE$-class.
Since every $\relD$-class includes at most $2^\szu$ cells and is nonempty, every
$D$-class has cardinality at most $3.2^\szu$ and there are at most
$(3^{2^\szu}-1)$ nonisomorphic $\relD$-classes included in $\eclX$.
Since every $\StrB$-organ has cardinality at most $2$, there are at most
$3.(3^{2^\szu}-1)$ $\relD$-classes included in $\eclX$.
\end{proof}
Recall from \cref{sec:granularity} that the finest equivalence relation in a
$\gr$-granular structure can be simulated by introducing $\bsz\gr$ fresh unary
predicate symbols.
By induction on $\nex$ we get:
\begin{corollary}\label{cor:twovar-sub-1}
Let $\szu,\nex \in \Nats$ such that $\nex \geq 2$.
Then $\vFoF2{\uesigS\szu\nex}$ has the finite model property and
\[
  \FinASat\vFoF2{\uesigS\szu\nex} \red\cP
  \FinASat\vFoF2{\uesigS\szup\nexp}.
\]
where $\nexp = \nex - 1$, $\szup = \szu + \bsz\gr$ and
$\gr = 3.(3^{2^\szu} - 1)$.
\end{corollary}

\begin{remark}
Consider $\sigS = \uesigS\szu1$ be a predicate signature consisting of the unary
predicate symbols $\suu\ii$ and the single builtin equivalence symbol $\sd$. 
Let $\StrA$ be a $\sigS$-structure.
There is $\StrB \subseteq \StrA$ such that $\StrA \vequiv2 \StrB$ and the
cardinality of $\StrB$ is at most $9.2^\szu.(3^{2^\szu}-1)$.
\end{remark}
\begin{proof}
Let $\sigSp = \sigS + \seq{\se}$ and let $\StrAp$ be a $\sigSp$-enrichment of
$\StrA$ where $\at\StrAp\se = \domAA$ is interpreted as the full relation on
$\domA$, so the symbols $\sd, \se$ are interpreted in $\StrAp$ as equivalence
relations on $\domA$ in refinement.
By \cref{lem:twovar-cell-2}, there is $\StrBp \subseteq \StrA$ such that
$\StrA \vequiv2 \StrBp$ and the cells of $\StrBp$ have cardinality at most $2$.
By \cref{lem:twovar-organ-2}, there is $\StrB \subseteq \StrBp$ such that
$\StrB \vequiv2 \StrBp$ and the organs of $\StrB$ have cardinality at most $2$.
Let $\relD = \at\StrB\sd$ and $\relE = \at\StrB\se$.
Clearly $\relE = \domBB$, so there is a single $\relE$-class and the
$\StrB$-organs partition the $\relD$-classes into groups of isomorphic classes.
Since every $\relD$-class includes at most $2^\szu$ cells and is nonempty, every
$\relD$-class has cardinality at most $3.2^\szu$.
Since $\StrB$ is $\gr$-granular for $\gr = 3.(3^{2^\szu}-1)$ and there is a
single $\relE$-class, the cardinality of $\StrB$ is at most
$9.2^\szu.(3^{2^\szu}-1)$.
\end{proof}

When the number of unary predicate symbols is constant $\szu$, independent of
the length of the formulas, we get:
\begin{proposition}
The logic $\Lvp\Fo20\Eea\nex\agrefine$ has the finite model
property and its (finite) satisfiability problem is in $\cP$.

By \cref{prop:global-to-refine-n} and \cref{prop:local-to-refine-n},
the same holds for the logics
$\Lvp\Fo20\Eea\nex\agglobal$ and 
$\Lvp\Fo20\Eea\nex\aglocal$.
\end{proposition}

For $\szu \in \Nats$ and $\nex \in \pNats$, let $\gr = 3.(3^{2^\szu}-1)$
and $\szup = \szu + \bsz{\gr}$.
Since
\[
  \bsz{\gr} = \lfloor \log{3.(3^{2^\szu}-1)} \rfloor + 1 <
   2 + 2.2^\szu+1 <
   8^\szu,
\]
we have $\szup < 9^\szu$.
By induction on $\nex$, the logic $\Lvp\Fo21\Eea\nex\agrefine$ has the
finite model property and for $\nexp = \nex-1$
\[
\FinASat\Lvp\Fo21\Eea\nex\agrefine \red\cExpTime
\FinASat\Lvp\Fo21\Eea\nexp\agrefine.
\]
Since the even stronger logic $\Lvp\Fo2\nopow\Eea1\agrefine$ has the
finite model property and its (finite) satisfiability problem is
$\cNExpTime$-complete~\cite{kieronski2005small}, we get:
\begin{proposition}
The logic $\Lvp\Fo21\Eea\nex\agrefine$ has the finite model property and
its (finite) satisfiability problem is in $\ceNExpTime\nex$.

By \cref{prop:global-to-refine-n} and \cref{prop:local-to-refine-n},
the same holds for the logics
$\Lvp\Fo21\Eea\nex\agglobal$ and $\Lvp\Fo21\Eea\nex\aglocal$.
\end{proposition}

If we allow unboundedly many unary predicate symbols, $\szu$ is on the order of
the length of the formula, and we get:
\begin{proposition}
The logic $\Lvp\Fo21\Eea\nonex\agrefine$ has the finite model property and its
(finite) satisfiability problem is in $\cElementary$.

By \cref{prop:global-to-refine} and \cref{prop:local-to-refine},
this also holds for the logics $\Lvp\Fo21\Eea\nonex\agglobal$
and $\Lvp\Fo21\Eea\nonex\aglocal$.
Trivially, this also holds for the logics $\Lvp\Fo20\Eea\nonex\agrefine$,
$\Lvp\Fo20\Eea\nonex\agglobal$ and $\Lvp\Fo20\Eea\nonex\aglocal$.
\end{proposition}

% TODO: better complexity
Using finer methods, we will give much better estimates for the complexity of
the (finite) satisfiability problems for $\Lvp\Fo21\Eea\nex\agrefine$,
$\Lvp\Fo21\Eea\nonex\agrefine$ and $\Lvp\Fo20\Eea\nonex\agrefine$.