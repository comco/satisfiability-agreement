% Type realizibility of the two-variable first-order logic
Recall from~\Cref{sec:scott-nf} about normal forms that every $\vFo2$-sentence
$\fphi$ can be reduced in deterministic polynomial time to a sentence
$\sctr\fphi$ in Scott normal form:
\[
  \forall\xx\forall\yy (\falpp0(\xx,\yy) \lor \xx = \yy) \land
  \bigwedge_{1 \leq \ii \leq \nm} \forall\xx\exists\yy(
  \falpp\ii(\xx,\yy) \land \xx \neq \yy),
\]
where $\nm \geq 1$, all the formulas $\falpp\ii$ are quantifier-free and use at
most linearly many new unary predicate symbols.
The semantical connection between $\fphi$ and $\sctr\fphi$ is that they are
essentially equisatisfiable. More precisely, every model of $\fphi$ of
cardinality at least $2$ can be enriched to a model for $\sctr\fphi$ and also
every model of $\sctr\fphi$ (which by $\nm \geq 1$ must have cardinality at
least $2$) is a model for $\fphi$.
We refer to $\falpp0$ as the \emph{universal part}, or the $\forall\forall$-part
of the formula $\sctr\fphi$ and to $\falpp\ii$ as the \emph{existential parts},
or the $\forall\exists$-parts of the formula, for $\ii \in [1,\nm]$.

\subsection{Classified signatures}
For any formula $\sctr\fphi$ in Scott normal form, we may replace its
existential parts by fresh binary predicate symbols: for $\ii \in [1,\nm]$, let
$\smm\ii$ be a fresh binary predicate symbol with the intended interpretation
$\forall\xx\forall\yy (\smm\ii(\xx,\yy) \lequ \falpp\ii(\xx,\yy))$. Since this
is a universal sentence, it can be incorporated into the $\forall\forall$-part
$\falpp0$ of the formula.
We refer to the symbols $\gls{message-symbol-m-i}$ as the \emph{message
symbols}.
Hence $\sctr\fphi$ can be transformed in deterministic polynomial time to the
form:
\begin{equation}\label{eq:twovar-msg-nf}
  \forall\xx\forall\yy (\falp(\xx,\yy) \lor \xx = \yy) \land
  \bigwedge_{1 \leq \ii \leq \nm} \forall\xx\exists\yy
  (\smm\ii(\xx,\yy) \land \xx \neq \yy),
\end{equation}
where the $\forall\forall$-part $\falp$ is quantifier-free and over an extended
signature. For convenience, we make the existential parts of the formula part of
the signature, so we can focus only on the universal part. The following is a
term similar to the one defined in~\cite{MALQ:MALQ201400102}:
\begin{definition}
A \emph{classified signature} $\gls{classified-signature-S-m}$ for the
two-variable first-order logic $\vFo2$ is a predicate signature $\SigS$ together
with a nonempty sequence $\sms = \smm1\smm2\dots\smm\nm$ of distinct binary
predicate symbols from $\SigS$ having intended interpretation
\begin{equation}\label{eq:twovar-ms-iinter}
  \bigwedge_{1 \leq \ii \leq \nm} \forall\xx\exists\yy 
  (\smm\ii(\xx,\yy) \land \xx \neq \yy).
\end{equation}
\end{definition}
That is, a classified signature \emph{automatically includes} the
$\forall\exists$-parts of formulas and $\ClSig\SigS\sms$-structures
\emph{automatically satisfy} the $\forall\exists$-parts:
\begin{definition}
A structure $\StrA$ for the classified signature $\ClSig\SigS\sms$ is a
structure for the predicate signature $\SigS$ that satisfies the intended
interpretation~\cref{eq:twovar-ms-iinter} of the message symbols. Note that
$\StrA$ must have cardinality at least $2$.
\end{definition}

\begin{definition}\label{def:clsig-twovar}
The \emph{(finite) classified satisfiability problem for two-variable
first-order logic} is:
given a classified signature $\ClSig\SigS\sms$ and a quantifier-free
$\vFoF2\SigS$-formula $\falp(\xx,\yy)$, is there a (finite)
$\ClSig\SigS\sms$-structure $\StrA$ satisfying~\cref{eq:twovar-msg-nf}.
Note that since $\StrA$ is a $\ClSig\SigS\sms$-structure, it must also
satisfy~\cref{eq:twovar-ms-iinter} and must have cardinality at least $2$.
Denote the classified satisfiability problem by $\ClSat{\vFo2}$ and its finite
version by $\FinClSat{\vFo2}$.
\end{definition}

\begin{remark}
The problem of (finite) satisfiability reduces in nondeterministic polynomial
time to the problem of (finite) classified satisfiability:
\[
  \FinASat{\vFo2} \red\cNP \FinAClSat{\vFo2}.
\]
\end{remark}
\begin{proof}

Note that (finite) satisfiability in the class of models of cardinality $1$ is
trivially decidable in nondeterministic polynomial time --- just guess the
atomic $1$-type (whose size is polynomially bounded by the size of the
predicate signature) of the unique element of the structure and check (in
deterministic polynomial time) that it satisfies the original formula.

Scott normal form shows that (finite) satisfiability in the class of models of
cardinality at least $2$ reduces in deterministic polynomial time to (finite)
classified satisfiability.
Hence the following nondeterministic polynomial time procedure reduces an
instance $(\SigS, \fphi)$ of the (finite) satisfiability problem to an instance
$(\ClSig\SigSp\sms, \falp)$ of the (finite) classified satisfiability problem:
First check if $\fphi$ is satisfiable in the class of models of cardinality $1$.
If that is the case, then extend $\SigS$ to $\SigSp$ by adding a single message
symbol $\smm1$ and let $\falp = (\xx = \xx)$ be a fixed predicate tautology.
Otherwise transform $\fphi$ into Scott normal form and let $\falp$ be the
universal part of that normal form.
\end{proof}

\subsection{Type instances}
\begin{definition}\label{def:tpinst-twovar}
A \emph{type instance} $\Tpi\TpiP\TpiT$ over the classified signature
$\ClSig\SigS\sms$ is a pair of a nonempty set of $1$-types
$\TpiP\subseteq\TpI\SigS$ and a nonempty set of $2$-types $\TpiT\subseteq\TpT\SigS$ satisfying the following conditions:
\begin{itemize}
  \item[\condtpii]
  The set of $2$-types $\TpiT$ is closed under inversion, that is
  $\inv\tpTt\in\TpiT$ for every $\tpTt\in\TpiT$.
  \item[\condtpic]
  Every $2$-type $\tpTt\in\TpiT$ connects $1$-types
  from $\TpiP$, that is $\xtp\tpTt\in\TpiP$ and $\ytp\tpTt\in\TpiP$ for every
  $\tpTt\in\TpiT$.
  Equivalently, 
  $(\xtp\restriction\TpiT)\subseteq\TpiP$ since $\TpiT$ is closed under
  inversion.
\end{itemize}
Two $1$-types $\tpIp, \tpIpp \in \TpiP$ are \emph{connectable} if some
$\tpTt\in\TpiT$ connects them.
Connectability is symmetric since $\TpiT$ is closed under inversion.
However, connectability is not necessarily neither transitive nor reflexive:
A $1$-type $\tpIk \in \TpiP$ is a \emph{king type} if 
it is not connectable with itself.
The set of king types is $\TKgi\TpiP\TpiT$.
A $1$-type $\tpIp \in \TpiP$ that is not a king type is a \emph{worker type}
and the set of worker types is $\TWki\TpiP\TpiT = \TpiP \sub \TKg(\TpiP,\TpiT)$.

If $\TpiPp \subseteq \TpiP$ and $\tpIp \in \TpiP$, define the
\emph{type subtraction} $\tsub\TpiPp\TpiT\tpIp$ by:
\[
  \tsub\TpiPp\TpiT\tpIp = \begin{cases}
    \TpiPp &\text{if } \tpIp \in \TWki\TpiP\TpiT \text{ is a worker type} \\
    \TpiPp \sub \set\tpIp &\text{otherwise, that is if } \tpIp \in
    \TKgi\TpiP\TpiT \text{ is a king type.}
  \end{cases}
\]
\end{definition}

\begin{definition}
Let $\StrA$ be a $\ClSig\SigS\sms$-structure.
\emph{The type instance} $\TPI\StrA = \Tpi\TpiP\TpiT$ of $\StrA$ is defined by:
\begin{align*}
  \TpiP &= \setbd{\tpIa\StrA\ea}{\ea \in \domA} \\
  \TpiT &= \setbd{\tpIab\StrA\ea\eb}{\ea \in \domA, \eb \in \domA \sub \set\ea}.
\end{align*}
That is, $\TpiP$ is the set of $1$-types realized in $\StrA$ and $\TpiT$ is the
set of $2$-types realized in $\StrA$.
Note that indeed $\Tpi\TpiP\TpiT$ is a type instance over $\ClSig\SigS\sms$.
\end{definition}
\begin{remark}\label{rem:tpi-char}
Let $\StrA$ be a $\ClSig\SigS\sms$-structure and let $\Tpi\TpiP\TpiT =
\TPI\StrA$ be the type instance of $\StrA$.
Then $\TKgi\TpiP\TpiT$ is the set of $1$-types that are realized by a unique
element in $\StrA$ and $\TWki\TpiP\TpiT$ is the set of $1$-types that are
realized by at least $2$ elements in $\StrA$.
Let $\tpIp \in \TpiP$ and let $\ea \in \domA$ realizes $\tpIp$. Then the type
subtraction $\tsub\TpiP\TpiT\tpIp = \setbd{\tpIa\StrA\eb}{\eb \in \domA \sub \set\ea}$ is the set of $1$-types
realized by elements other than $\ea$.
\end{remark}

\begin{definition}
The \emph{(finite) type realizability problem} is: given a classified signature
$\ClSig\SigS\sms$ and a type instance $\Tpi\TpiP\TpiT$ over $\ClSig\SigS\sms$,
is there a (finite) $\ClSig\SigS\sms$-structure $\StrA$ such that $\TPI\StrA =
\Tpi\TpiP\TpiT$.
Denote the type realizability problem by $\Real{\vFo2}$ and its finite version
by $\FinReal{\vFo2}$.
\end{definition}

\begin{remark}\label{rem:red-sat-to-real}
Let $\ClSig\SigS\sms$ be a classified signature and let $\falp(\xx,\yy)$ be a
quantifier-free $\vFoF2\SigS$-formula.
Define the following sets of types:
\begin{itemize}
  \item $\TpiP^\falp \subseteq \TpI\SigS$ is the set of those $1$-types
  consistent with $\falp(\xx,\yy)$ and the intended
  interpretation~\cref{eq:twovar-ms-iinter}.
  \item $\TpiT^\falp \subseteq \TpT\SigS$ is the set of those $2$-types $\tpTt$
  such that both $\tpTt$ and $\inv\tpTt$ are consistent with $\falp(\xx,\yy)$
  and the intended interpretation~\cref{eq:twovar-ms-iinter}.
\end{itemize}
Then a $\ClSig\SigS\sms$-structure $\StrA$ is a classified model for
$\falp(\xx,\yy)$ iff there are some subsets $\TpiP \subseteq \TpiP^\falp$ and
$\TpiT \subseteq \TpiT^\falp$ such that  $\Tpi\TpiP\TpiT = \TPI\StrA$.

Recall that the number of possible $1$-types or $2$-types over $\SigS$ is
exponentially bounded by the size of $\SigS$ and that the size of a $1$-type or
a $2$-type over $\SigS$ is linearly bounded by the size of $\SigS$.
Hence the (finite) classified satisfiability problem reduces to the
(finite) type realizability problem in nondeterministic exponential time:
\[
  \FinAClSat{\vFo2} \red\cNExpTime \FinAReal{\vFo2}.
\]
\end{remark}

\begin{definition}
Let $\Tpi\TpiP\TpiT$ be a type instance over $\ClSig\SigS\sms$.
A \emph{star-type} $\stps \subseteq \TpiT$ over $\Tpi\TpiP\TpiT$ is a nonempty
set of $2$-types satisfying the following conditions:
\begin{itemize}
  \item[\condstpx]\label{cond:stpx}
  If $\tpTt, \tpTtp \in \stps$, then $\xtp\tpTt = \xtp\tpTtp$, that is the
  $\xx$-type of every element of $\stps$ is the same.

  Denote the $\xx$-type of any element of $\stps$ by $\tpIp = \xtp\stps$.
  The star-type is a \emph{king star-type} if $\tpIp$ is a king type.
  Otherwise, that is if $\tpIp$ is a worker type, the star-type is a
  \emph{worker star-type}.
  \item[\condstppy]\label{cond:stppy}
  If $\tpIpp \in \tsub\TpiP\TpiT\tpIp$, then some $\tpTt \in \stps$ has
  $\ytp\tpTt = \tpIpp$.
  
  \item[\condstpky]\label{cond:stpky}
  If $\tpIkp \in \tsub{\TKgi\TpiP\TpiT}\TpiT\tpIp$, then a unique $\tpTt \in
  \stps$ has $\ytp\tpTt = \tpIkp$. Note that the existence follows
  from~\refcondstppy.
  \item[\condstpm]\label{cond:stpm}
  If $\sm \in \sms$, then $\sm(\xx,\yy) \in \tpTt$ for some $\tpTt \in \stps$.
\end{itemize}
Note that the size of a star-type is linearly bounded by the size of the type
instance.
\end{definition}

\begin{definition}\label{def:stp-str}
Let $\Tpi\TpiP\TpiT$ be a type instance over $\ClSig\SigS\sms$
and let $\StrA$ be a model for $\Tpi\TpiP\TpiT$.
If $\ea \in \domA$, \emph{the star-type} $\stps = \stpIa\StrA\ea$ of $\ea$ is
defined by:
\[
  \stpIa\StrA\ea = \setbd{\tpIab\StrA\ea\eb}{\eb \in \domA \sub \set{\ea}}.
\]
Note that indeed $\stps$ is a star-type over $\Tpi\TpiP\TpiT$.
\end{definition}

\begin{remark}[Star-type extension]\label{rem:star-type-ext}
Let $\Tpi\TpiP\TpiT$ be a type instance over $\ClSig\SigS\sms$,
let $\stps$ be a star-type over $\Tpi\TpiP\TpiT$ and let $\tpIp = \xtp\stps$.
Let $\tpTt \in \TpiT$ be a $2$-type such that $\xtp\tpTt = \tpIp$ and
$\ytp\tpTt$ is not a king type.
Then $\stpsp = \stps \cup \set{\tpTt}$ is also a star-type over
$\Tpi\TpiP\TpiT$.
\end{remark}

\begin{definition}
Let $\Tpi\TpiP\TpiT$ be a type instance over $\ClSig\SigS\sms$.
A \emph{certificate} $\Cert$ for the type instance
$\Tpi\TpiP\TpiT$ is a nonempty set of star-types over $\Tpi\TpiP\TpiT$
satisfying the following conditions:
\begin{itemize}
  \item[\condcertT]\label{cond:certT}
  $\cup\Cert = \TpiT$, that is there is a star-type for the endpoints of every
  $2$-type.
  \item[\condcertk]\label{cond:certk}
  If $\tpIk \in \TKgi\TpiP\TpiT$, then a unique $\stps \in \Cert$ has $\xtp\stps
  = \tpIk$.
\end{itemize}
\end{definition}

Note that in general the size of a certificate may be exponential in
the size of the type instance. However, polynomial certificates exist:
\begin{lemma}[Certificate extraction]\label{lem:cert-extract}
Let $\Tpi\TpiP\TpiT$ be a type instance over $\ClSig\SigS\sms$ and let $\StrA$
be a model for $\Tpi\TpiP\TpiT$.
For every $2$-type $\tpTt \in \TpiT$, let $\eat\tpTt \neq \ebt\tpTt \in \domA$
be two distinct elements realizing $\tpTt$, that is
$\tpIab\StrA{\eat\tpTt}{\ebt\tpTt} = \tpTt$.
Let $\Cert = \setbd{\stpIa\StrA{\eat\tpTt}}{\tpTt\in\TpiT}$.
Then $\Cert$ is a certificate for $\Tpi\TpiP\TpiT$.
Note that the size of $\Cert$ is linearly bounded by the size of the type
instance.
\end{lemma}

\begin{lemma}[Certificate expansion]\label{lem:cert-expand}
Let $\Tpi\TpiP\TpiT$ be a type instance over $\ClSig\SigS\sms$ and let $\Cert$
be a certificate for $\Tpi\TpiP\TpiT$.
Then $\Tpi\TpiP\TpiT$ has a finite model.

More precisely, let $\pt \geq \card{\TpiT}$ be a parameter.
Then $\Tpi\TpiP\TpiT$ has a finite model in which each worker type is realized
at least $\pt$ times.
\end{lemma}
\begin{proof}
We adapt the standard strategy\footnote{with the slight difference that our
approach doesn't need \emph{a court}, since the information about it is implicit
in the certificate} used in the proof of the finite model property for the logic
$\vFo2$, as presented in~\cite{gradel1999logics}.
We build a model $\StrA$ for $\Tpi\TpiP\TpiT$ as follows.
The domain $\domA$ of $\StrA$ is the union of the following disjoint sets of
elements:
\begin{itemize}
  \item
  The singleton set $\As\stps = \set{\as\stps}$ for every king star-type
  $\stps\in\Cert$, $\xtp\stps \in \TKgi\TpiP\TpiT$.
  The elements $\as\stps$ are the \emph{kings}.
  \item 
  The three disjoint copies of $\pt$ elements
  $\As\stps = \Asi\stps0 \cup \Asi\stps1 \cup \Asi\stps2$ for every
  worker star-type $\stps \in \Cert$, $\xtp\stps \in \TPsi\TpiP\TpiT$,
  where $\Asi\stps\ii = \set{\asij\stps\ii1, \asij\stps\ii2, \dots,
  \asij\stps\ii\pt}$ for $\ii \in \set{0,1,2}$.
  The elements $\asij\stps\ii\jj$ are the \emph{workers}.
\end{itemize}
Let $\itpsOP : \domA \to \Cert$ denote the intended star-type of the elements:
$\itps\ea = \stps$ on $\As\stps$.
Let $\itpiOP : \domA \to \TpiP$ denote the intended $1$-type of the elements:
$\itpi\ea = \xtp(\stps(\ea))$.
We proceed to consistently assign $2$-types to pairs of distinct elements from
the structure on stages.
\begin{description}
  \item[Realization of kings] We first find witnesses for the intended
  star-types of the kings.
  Let $\stps \in \Cert$, $\tpIk = \xtp\stps \in \TKgi\TpiP\TpiT$ be a king
  star-type and let $\ea = \eat\stps$ be the unique king that intends to realize
  $\tpIk$.
  For every $\tpTt \in \stps$ we will find a distinct element $\ebt\tpTt \in
  \domA \sub \set\ea$ for the assignment $\tpIab\StrA\ea{\ebb\tpTt} = \tpTt$.
  Let $\tpTt \in \csps$ and $\tpIpp = \ytp\tpTt$.
  \begin{enumerate}
  \item 
  Suppose that $\tpIpp = \tpIkp \in \TKgi\TpiP\TpiT$ is a king type.
  By~\refcondcertk~there is a unique $\cspsp \in \Cert$ having $\xtp\cspsp =
  \tpIkp$.
  Since $\tpTt$ connects $\tpIk$ with $\tpIkp$ and a king
  type is not connectable with itself, we must have $\tpIkp \neq \tpIk$, hence
  also $\cspsp \neq \csps$ and $\eat\cspsp \neq \ea$.
  Let $\ebt\tpTt = \eat\cspsp$ and assign $\tpIab\StrA\ea{\ebt\tpTt} = \tpTt$.
  We must verify that the assignment is appropriate.
  First, since $\tpIkp \in \tsub\TpiP\TpiT\tpIk$, by~\refcondstpky~no other
  $\tpTtp \in \csps$ has $\ytp\tpTtp = \tpIkp$.
  Next, the assignment is symmetric.
  Indeed, $\inv\tpTt \in \TpiT$ and by~\refcondcertT, $\inv\tpTt \in \stpspp$
  for some $\stpspp \in \Cert$. Since $\xtp{\inv\tpTt} = \tpIkp$ is a king type,
  by~\refcondcertk~we get $\stpspp = \stpsp$. Since $\ytp{\inv\tpTt} = \tpIk
  \neq \tpIkp$ is a king type, by~\refcondstpky~the $2$-type $\inv{\tpTt} \in
  \stpsp$ is the unique that has $\ytp\tpTt = \tpIk$.
  
  \item
  Suppose that $\tpIpp \in \TWki\TpiP\TpiT$ is a worker type (hence $\tpIpp \neq
  \tpIk$).
  We simultaneously find distinct $\ebt\tpTu$ for all $2$-types $\tpTu \in
  \stps$ that are parallel to $\tpTt$.
  Let $\TpiU = \setbd{\tpTu\in \stps}{\ytp\tpTu = \tpIpp}$ be the set of all
  such $2$-types $\tpTu$.
  Since $\TpiU \subseteq \stps$, there are at most $t$ such $2$-types $\tpTu$.
  By~\refcondcertT, for every $\tpTu \in \TpiU$ let $\stpspN\tpTu \in \Cert$ be
  such that $\inv\tpTu \in \stpspN\tpTu$.
  Since $\xtp\stpspt\tpTu = \xtp{\inv\tpTu} = \tpIpp$ is a worker type, there
  are enough distinct elements $\ebt\tpTu \in \Asi{\stpspt\tpTu}0$ having
  intended star-type $\stpspt\tpTu$.
  We assign $\tpIab\StrA\ea{\ebt\tpTu} = \tpTu$ for every $\tpTu \in \TpiU$.
  \end{enumerate}
  \item[Realization of workers]
  We now find witnesses for the intended star-types of the worker elements.
  Let $\stps \in \Cert$, $\tpIp = \xtp\stps \in \TWki\TpiP\TpiTp$ be a worker
  star-type 
  and let $\ea = \asij\stps\ii\jj$, $\ii \in \set{0,1,2}$, $\jj \in [1,\pt]$ be
  an arbitrary worker with intended star-type $\stps$.
  For every $\tpTt \in \stps$ we will find a distinct element $\ebt\tpTt \in
  \domA \sub \set\ea$ for the assignment $\tpIab\StrA\ea{\ebt\tpTt} = \tpTt$.
  Let $\tpTt \in \stps$ and $\tpIpp = \ytp\tpTt$.
  \begin{enumerate}
    \item 
    Suppose that $\tpIpp = \tpIkp \in \TKgi\TpiP\TpiT$ is a king type (hence
    $\tpIkp \neq \tpIp$). By~\refcondcertk~there is a unique $\stpsp \in \Cert$
    having $\xtp\stpsp = \tpIkp$.
    Let $\ebt\tpTt = \eat\stpsp$ be the unique king that intends to realize
    $\tpIkp$. 
    First suppose that $\tpIab\StrA{\ebt\tpTt}\ea = \tpTu$ has already
    been assigned during the realization of the kings. By that construction
    $\inv\tpTu \in \stpspN\tpTu = \csps$. Since $\ytp{\inv\tpTu} = \tpIkp$,
    by~\refcondstpky~we have that $\inv\tpTu \in \csps$ is the unique having
    $\ytp{\inv\tpTu} = \tpIkp$, so $\tpTt = \inv\tpTu$ has already been
    assigned.
    
    Next suppose that $\tpIab\StrA{\ebt\tpTt}\ea$ has not been assigned during
    the realization of the kings.
    Then just assign $\tpIab\StrA\ea{\ebt\tpTt} = \tpTt$.
    Note that this may extend the actual star-type of the king $\ebt\tpTt$ beyond its
    intended star-type $\itps\ec$ by adding the type $\inv\tpTt$, but
    by~\Cref{rem:star-type-ext}, this extension is still a star-type. That is,
    in the end, the structure may realize \emph{more} than the intended
    star-types, but, importantly, \emph{not less}.
    \item 
    Suppose that $\tpIpp \in \TWki\TpiP\TpiT$ is a worker type.
    We simultaneously find distinct workers $\ebt\tpTu$ \emph{from the next
    copy} for all $\tpTu \in \stps$ that are parallel to $\tpTt$.
    Let $\TpiU = \setbd{\tpTu \in \stps}{\ytp\tpTu = \tpIpp}$.
    Let $\iip = (\ii+1 \bmod 3) \in \set{0,1,2}$.
    Again, there are at most $\pt$ $2$-types $\tpTu$ in $\TpiU$.
    By~\refcondcertT, for every $\tpTu \in \TpiU$ let $\stpspN\tpTu \in \Cert$
    be such that $\inv\tpTu \in \stpspN\tpTu$.
    Again, there are enough distinct elements $\ebt\tpTu \in
    \Asi{\stpspt\tpTu}\iip$ having intended star-type $\stpspt\tpTu$.
    We assign $\tpIab\StrA\ea{\ebt\tpTu} = \tpTu$ for every $\tpTu \in \TpiU$.
    All these assignments are appropriate, since they have been made between
    workers from consecutive copies in the structure.
  \end{enumerate}
  \item[Completion]
  Suppose that $\ea \neq \eb \in \domA$ are distinct elements such that
  $\tpIab\StrA\ea\eb$ has not yet been assigned. By~\refcondstpky~we must have
  that $\eb$ is a worker and symmetrically $\ea$ is a worker.
  Let $\tpIp = \tpIp(\ea)$ and $\tpIpp = \tpIp(\eb)$ be their intended types and
  let $\stps = \stps(\ea)$. Then since $\tpIpp \in \tsub\TpiP\TpiT\tpIp$,
  by~\refcondstppy~some $\tpTt \in \stps$ connects $\tpIp$ with $\tpIpp$. Then
  assign $\tpIab\StrA\ea\eb = \tpTt$. Again, this might extend the actual
  star-types of $\ea$ and $\eb$ beyond their intended star-types, but
  by~\Cref{rem:star-type-ext}, this extension is still a star-type.
\end{description}
The structure $\StrA$ is a $\ClSig\SigS\sms$-structure by~\refcondstpm~and is a
model for $\Tpi\TpiP\TpiT$ by~\refcondcertT.
\end{proof}

\begin{proposition}
The type realizability problem for $\vFo2$ coincides with the finite type
realizability problem and is in $\cNP$.
\end{proposition}
\begin{proof}
Let $\Tpi\TpiP\TpiT$ be a type instance for the classified signature
$\ClSig\SigS\sms$. Guess a polynomial certificate for $\Tpi\TpiP\TpiT$.
By~\Cref{lem:cert-extract} and~\Cref{lem:cert-expand}, such a certificate exists
iff $\Tpi\TpiP\TpiT$ is realizable.
The general version coincides with the finite version since the model
constructed in~\Cref{lem:cert-expand} is finite.
\end{proof}
\begin{corollary}\cite{gradel1997decision}
The logic $\vFo2$ has the finite model property and its (finite) satisfiability
problem is in $\cNExpTime$.
\end{corollary}